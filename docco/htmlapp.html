<!DOCTYPE html>

<html>
<head>
  <title>imports</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="htmlapp.html">
                  htmlapp.js
                </a>
              
                
                <a class="source" href="index.html">
                  index.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>;
(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> log = <span class="hljs-built_in">console</span>.log.bind(<span class="hljs-built_in">console</span>);
  <span class="hljs-keyword">var</span> info = <span class="hljs-built_in">console</span>.info.bind(<span class="hljs-built_in">console</span>);
  <span class="hljs-keyword">var</span> debug = <span class="hljs-built_in">console</span>.debug.bind(<span class="hljs-built_in">console</span>);
  <span class="hljs-keyword">var</span> error = <span class="hljs-built_in">console</span>.error.bind(<span class="hljs-built_in">console</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h1 id="imports">imports</h1>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
  R = <span class="hljs-built_in">window</span>[<span class="hljs-string">'remote'</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h1 id="logic">Logic</h1>

            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Use YDN-DB to access IndexedDB</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-keyword">var</span> storeName = <span class="hljs-string">'apps'</span>;
  <span class="hljs-keyword">var</span> schema = {
    stores: [{
      name: storeName,
      autoIncrement: <span class="hljs-literal">false</span>
    } ]
  };
  <span class="hljs-keyword">var</span> db = <span class="hljs-keyword">new</span> ydn.db.Storage(<span class="hljs-string">'htmlapps'</span>, schema);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>constructor</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> App = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{};

  App.prototype.loadStyle = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">cssData, document, clearExisting</span>) </span>{
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
    debug(<span class="hljs-string">'loadStyle'</span>);

    <span class="hljs-keyword">var</span> head = <span class="hljs-built_in">document</span>.head || <span class="hljs-built_in">document</span>.getElementsByTagName(<span class="hljs-string">'head'</span>)[<span class="hljs-number">0</span>];

    <span class="hljs-keyword">if</span> (clearExisting) {</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>remove the current stylesheets</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">while</span> (<span class="hljs-built_in">document</span>.getElementsByTagName(<span class="hljs-string">'style'</span>).length &gt; <span class="hljs-number">0</span>) {
        head.removeChild(<span class="hljs-built_in">document</span>.getElementsByTagName(<span class="hljs-string">'style'</span>)[<span class="hljs-number">0</span>]);
      }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>create the new stylesheet</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (cssData) {

      <span class="hljs-keyword">var</span> style = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'style'</span>);

      style.type = <span class="hljs-string">'text/css'</span>;
      <span class="hljs-keyword">if</span> (style.styleSheet) {
        style.styleSheet.cssText = cssData;
      } <span class="hljs-keyword">else</span> {
        style.appendChild(<span class="hljs-built_in">document</span>.createTextNode(cssData));
      }

      head.appendChild(style);
    }
  };

  App.prototype.createMainPage = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;

    <span class="hljs-built_in">document</span>.head.title = <span class="hljs-string">'htmlapp - main page'</span>;

    <span class="hljs-keyword">var</span> css =
      <span class="hljs-string">'html,'</span> +
      <span class="hljs-string">'body {'</span> +
      <span class="hljs-string">'  height: 100%'</span> +
      <span class="hljs-string">'}'</span> +
      <span class="hljs-string">'#menu {'</span> +
      <span class="hljs-string">'  height: 10%'</span> +
      <span class="hljs-string">'}'</span> +
      <span class="hljs-string">'#varps {'</span> +
      <span class="hljs-string">'  height: 90%'</span> +
      <span class="hljs-string">'}'</span>;

    self.loadStyle(css, <span class="hljs-built_in">document</span>, <span class="hljs-literal">false</span>);

    <span class="hljs-keyword">var</span> normalize =
      <span class="hljs-string">'/*! normalize.css v3.0.2 | MIT License | git.io/normalize */html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:bold}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-0.5em}sub{bottom:-0.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}input[type="number"]::-webkit-inner-spin-button,input[type="number"]::-webkit-outer-spin-button{height:auto}input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0}textarea{overflow:auto}optgroup{font-weight:bold}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}'</span>;
    self.loadStyle(normalize, <span class="hljs-built_in">document</span>, <span class="hljs-literal">false</span>);

    <span class="hljs-keyword">var</span> menu = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'div'</span>);
    menu.id = <span class="hljs-string">'menu'</span>;
    <span class="hljs-built_in">document</span>.body.appendChild(menu);

    <span class="hljs-keyword">var</span> varps = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'div'</span>);
    varps.id = <span class="hljs-string">'varps'</span>
    <span class="hljs-built_in">document</span>.body.appendChild(varps);
  };

  App.prototype.loadVarp = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">varpDef</span>) </span>{
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;

    debug(<span class="hljs-string">'load varp:'</span> + varpDef.id +
      <span class="hljs-string">' with permissions:'</span> + varpDef.permissions);</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>check mandatory input</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!varpDef || !varpDef.id) {

      <span class="hljs-keyword">throw</span> <span class="hljs-string">'varp id must me specified. See varphelp'</span>;
    }

    <span class="hljs-keyword">if</span> (!varpDef.permissions) {
      varpDef.permissions = <span class="hljs-string">'allow-scripts allow-forms'</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Create an iframe element using an input object:</p>
<pre><code> {
   id: <span class="hljs-string">''</span>,
   data: <span class="hljs-string">''</span>
   target: object,
   permissions: <span class="hljs-string">''</span>
 }
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> createIFrame = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">input</span>) </span>{
      debug(<span class="hljs-string">'createIFrame '</span> + input.id);</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Get rid of HTML comments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      input.data = Helpers.removeHTMLComments(input.data);

      <span class="hljs-keyword">var</span> title = Helpers.parseHTMLTag(<span class="hljs-string">'title'</span>, input.data, <span class="hljs-literal">false</span>);
      <span class="hljs-keyword">var</span> scripts = Helpers.parseHTMLTag2(<span class="hljs-string">'script'</span>, input.data);
      <span class="hljs-keyword">var</span> styles = Helpers.parseHTMLTag(<span class="hljs-string">'style'</span>, input.data, <span class="hljs-literal">false</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>This will include the whole body including script tags</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> bodyObj = Helpers.parseHTMLTag2(<span class="hljs-string">'body'</span>, input.data, <span class="hljs-literal">false</span>)[<span class="hljs-number">0</span>];
      <span class="hljs-keyword">var</span> body = [bodyObj.inner];
      <span class="hljs-keyword">var</span> eventsToRegister = <span class="hljs-literal">null</span>;

      <span class="hljs-keyword">var</span> iframe = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'iframe'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>The only attribute that is supported is:
data-gna-send=’[“event1”, …, “eventN”]’</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (bodyObj.attr) {
        <span class="hljs-keyword">var</span> bodyAttr = bodyObj.attr.trim();
        eventsToRegister = Helpers.jsonParse(bodyAttr.substr(<span class="hljs-number">15</span>, bodyAttr.length - <span class="hljs-number">15</span> - <span class="hljs-number">1</span>));
        debug(<span class="hljs-string">'updateIframe '</span> + input.id + <span class="hljs-string">' send='</span> + eventsToRegister);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>This is necesseray for Firefox, the real permissions are set at the end
Set the sandbox permissions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (input.permissions !== <span class="hljs-string">''</span>) {
        iframe.sandbox = <span class="hljs-string">'allow-same-origin allow-scripts'</span>;
      }

      iframe.id = input.id;</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>this is executed when the iframe has been loaded</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> updateIframe = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) </span>{
        debug(<span class="hljs-string">'updateIframe '</span> + input.id + <span class="hljs-string">' (load event fired)'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>This works in all browsers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> iframeDoc = event.target.contentDocument;

        iframeDoc.body.innerHTML = (body) ? body[<span class="hljs-number">0</span>] : <span class="hljs-literal">null</span>;
        iframeDoc.head.title = (title) ? title[<span class="hljs-number">0</span>] : <span class="hljs-literal">null</span>;

        iframe.style.width = <span class="hljs-string">'100%'</span>;
        iframe.style.height = <span class="hljs-string">'100%'</span>;
        iframe.style.border = <span class="hljs-number">0</span>;
        iframe.hidden = <span class="hljs-literal">true</span>;

        self.loadStyle(styles, iframeDoc, <span class="hljs-literal">false</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <h2 id="load-the-scripts-they-are-not-intialized-otherwise">Load the scripts - they are not intialized otherwise</h2>

            </div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
        <span class="hljs-keyword">if</span> (eventsToRegister) {
          self.customEvents_.concat(eventsToRegister);
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; eventsToRegister.length; i++) {
            <span class="hljs-built_in">document</span>.addEventListener(eventsToRegister[i], handler);
          }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Set the sandbox permissions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (input.permissions !== <span class="hljs-string">''</span>) {
          event.target.sandbox = input.permissions;
          debug(<span class="hljs-string">'permissions set to: '</span> +
            <span class="hljs-built_in">document</span>.getElementById(iframe.id).sandbox);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>This is a promise-based alternative, but the login screen isn’t
initialized for some reason
     self.fetchRemoteScripts2(scripts).then(function(scripts) {</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        self.varpBucket_.get(varpDef.id + <span class="hljs-string">'.js'</span>).then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">scripts</span>) </span>{
          debug(<span class="hljs-string">'updateIframe with id '</span> + input.id +
            <span class="hljs-string">': '</span> + scripts.length + <span class="hljs-string">' remote scripts fetched.'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>remove the scripts from the body</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">var</span> tmpScripts = iframeDoc.getElementsByTagName(<span class="hljs-string">'script'</span>);
          <span class="hljs-keyword">while</span> (tmpScripts.length &gt; <span class="hljs-number">0</span>) {
            iframeDoc.body.removeChild(tmpScripts[<span class="hljs-number">0</span>]);
          }</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Add the scripts to the head</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; scripts.length; i++) {
            self.loadScript(scripts[i], input.id + <span class="hljs-string">'_script'</span> + i,
              iframeDoc.head);
          }</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>run the init function if it exists</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">if</span> (iframe.contentWindow.init) {
            debug(<span class="hljs-string">'Initializing frame.'</span>)
            iframe.contentWindow.init();
          }

        });

      };

      iframe.addEventListener(<span class="hljs-string">"load"</span>, updateIframe, <span class="hljs-literal">true</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Add iframe to varps element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      input.target.appendChild(iframe);

      <span class="hljs-keyword">return</span> iframe;
    };

    <span class="hljs-keyword">var</span> addMenu = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{
      <span class="hljs-keyword">var</span> el = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'input'</span>);
      el.type = <span class="hljs-string">'button'</span>;
      el.value = val;
      el.id = <span class="hljs-string">'btn'</span> + val;

      <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'menu'</span>).appendChild(el);
    };

    <span class="hljs-keyword">var</span> load = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">html</span>) </span>{

      <span class="hljs-keyword">var</span> input = {
        id: varpDef.id,
        target: <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'varps'</span>),
        permissions: varpDef.permissions,
        data: html
      };

      varpDef.element = createIFrame(input);
      addMenu(varpDef.id);

    };</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <h2 id="end-of-helpers">end of helpers</h2>

            </div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="hljs-keyword">return</span> db.get(storeName, varpDef.id+<span class="hljs-string">'.html'</span>).then(load).catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
      debug(<span class="hljs-string">'loadVarp:'</span> + varpDef.id + <span class="hljs-string">':'</span> + e);
      <span class="hljs-keyword">return</span> e.toString();
    });
  };

  App.prototype.unloadVarp = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">id</span>) </span>{
    <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'menu'</span>).removeChild(<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'btn'</span> + id))
  }

  App.prototype.showVarp = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">iframeId</span>) </span>{
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;

    debug(<span class="hljs-string">'showVarp:'</span> + iframeId);

    <span class="hljs-keyword">var</span> vs = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'varps'</span>);
    <span class="hljs-keyword">var</span> v = <span class="hljs-built_in">document</span>.getElementById(iframeId);</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>check that the iframe exists</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (v === <span class="hljs-literal">null</span>) {
      <span class="hljs-keyword">return</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>hide all varps</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; vs.childNodes.length; i++) {
      vs.childNodes[i].hidden = <span class="hljs-literal">true</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>show the varp</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    v.hidden = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>dispatch show event to the relevant frame</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    dispatchEvent(iframeId, <span class="hljs-string">'gnaEvent'</span>, <span class="hljs-string">'show'</span>);
  };

  <span class="hljs-keyword">var</span> dispatchEvent = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">frameId, eventName, message</span>) </span>{

    <span class="hljs-keyword">var</span> event = <span class="hljs-keyword">new</span> CustomEvent(
      eventName, {
        detail: { <span class="hljs-comment">// detail is a custom object</span>
          message: message,
          time: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(),
        },
        bubbles: <span class="hljs-literal">true</span>,
        cancelable: <span class="hljs-literal">true</span>
      }
    );

    <span class="hljs-keyword">var</span> el = <span class="hljs-built_in">document</span>.getElementById(frameId).contentDocument;

    el.dispatchEvent(event);
  };

  <span class="hljs-keyword">var</span> removeHTMLComments = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">str</span>) </span>{
    <span class="hljs-keyword">if</span> (!str || str.length === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;

    <span class="hljs-keyword">var</span> start = str.indexOf(<span class="hljs-string">'&lt;!--'</span>);
    <span class="hljs-keyword">var</span> end = str.indexOf(<span class="hljs-string">'--&gt;'</span>);

    <span class="hljs-keyword">if</span> (start === <span class="hljs-number">-1</span> || end === <span class="hljs-number">-1</span>) <span class="hljs-keyword">return</span> str;

    <span class="hljs-keyword">var</span> res = str.substring(<span class="hljs-number">0</span>, start);
    str = str.substring(end + <span class="hljs-number">3</span>, str.length);

    <span class="hljs-keyword">var</span> res2 = Helpers.removeHTMLComments(str);
    <span class="hljs-keyword">return</span> res.concat(res2);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Outer or inner allowing (but not returning) attributes in tag</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> parseHTMLTag = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">tag, str, outer</span>) </span>{
    <span class="hljs-keyword">if</span> (!str || str.length === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> [];</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>find start of beginning and end tags</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> startStartTag = str.indexOf(<span class="hljs-string">'&lt;'</span> + tag);
    <span class="hljs-keyword">var</span> startEndTag = str.indexOf(<span class="hljs-string">'&lt;/'</span> + tag + <span class="hljs-string">'&gt;'</span>);
    <span class="hljs-keyword">if</span> (startStartTag === <span class="hljs-number">-1</span> || startEndTag === <span class="hljs-number">-1</span>) <span class="hljs-keyword">return</span> [];</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>check that the tag has an end</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> endStartTag = str.substring(startStartTag + tag.length, str.length).indexOf(<span class="hljs-string">'&gt;'</span>);
    <span class="hljs-keyword">if</span> (endStartTag === <span class="hljs-number">-1</span>) <span class="hljs-keyword">return</span> [];
    endStartTag += startStartTag + tag.length;

    <span class="hljs-keyword">var</span> startTagLength = endStartTag - startStartTag;
    <span class="hljs-keyword">var</span> endTagLength = (<span class="hljs-string">'&lt;/'</span> + tag + <span class="hljs-string">'&gt;'</span>).length;

    <span class="hljs-keyword">var</span> res;
    res = (outer) ? str.substring(startStartTag, startEndTag + endTagLength) :
      str.substring(startStartTag + startTagLength + <span class="hljs-number">1</span>, startEndTag);

    str = str.substring(startEndTag + endTagLength, str.length);

    <span class="hljs-keyword">var</span> res2 = Helpers.parseHTMLTag(tag, str, outer);
    <span class="hljs-keyword">return</span> [res].concat(res2);

  };</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Outer and inner with attributes in tag including the attributes
[{outer:…, inner:…, attr:…}]
TODO: should refactor and combine this with parseHTMLTag</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> parseHTMLTag2 = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">tag, str</span>) </span>{
    <span class="hljs-keyword">if</span> (!str || str.length === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> [];</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>find start of beginning and end tags</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> startStartTag = str.indexOf(<span class="hljs-string">'&lt;'</span> + tag);
    <span class="hljs-keyword">var</span> startEndTag = str.indexOf(<span class="hljs-string">'&lt;/'</span> + tag + <span class="hljs-string">'&gt;'</span>);
    <span class="hljs-keyword">if</span> (startStartTag === <span class="hljs-number">-1</span> || startEndTag === <span class="hljs-number">-1</span>) <span class="hljs-keyword">return</span> [];</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>check that the tag has an end</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> endStartTag = str.substring(startStartTag + tag.length, str.length).indexOf(<span class="hljs-string">'&gt;'</span>);
    <span class="hljs-keyword">if</span> (endStartTag === <span class="hljs-number">-1</span>) <span class="hljs-keyword">return</span> [];
    endStartTag += startStartTag + tag.length;

    <span class="hljs-keyword">var</span> startTagLength = endStartTag - startStartTag;
    <span class="hljs-keyword">var</span> endTagLength = (<span class="hljs-string">'&lt;/'</span> + tag + <span class="hljs-string">'&gt;'</span>).length;

    <span class="hljs-keyword">var</span> res = {};
    res.outer = str.substring(startStartTag, startEndTag + endTagLength);
    res.inner = str.substring(startStartTag + startTagLength + <span class="hljs-number">1</span>, startEndTag);
    res.attr = str.substring(startStartTag + (<span class="hljs-string">'&lt;'</span> + tag).length, endStartTag);

    str = str.substring(startEndTag + endTagLength, str.length);

    <span class="hljs-keyword">var</span> res2 = Helpers.parseHTMLTag2(tag, str);
    <span class="hljs-keyword">return</span> [res].concat(res2);

  };</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <h1 id="export">Export</h1>

            </div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-built_in">window</span>[<span class="hljs-string">'htmlapp'</span>] = App;


}());</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
